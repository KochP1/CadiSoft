{% extends 'base.html' %}
{% block title %} Cursos {% endblock %}

{% block content %} 
    <div class="alumnos-options__wrapper">
        <h1>Secciones de {{cursos[0].nombre_curso.lower()}}</h1>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>{{message}}</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                        </button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="alumnos-options__container">
            <button class="btn btn-primary btn-reporte" onclick="imprimirReporte()">Generar reporte</button>
            <button class="btn btn-primary btn-excel" onclick="migrarExcel()">Migrar a excel</button>
            <a href="{{url_for('cursos.crear_seccion', idCurso=cursos[0].idCurso)}}">
                <button class="btn btn-primary btn-crear">Crear sección</button>
            </a>
            <button class="btn btn-primary btn-reporte" data-bs-toggle="modal" data-bs-target="#filtrar-secciones-modal">Filtrar por cantidad de alumnos</button>
            <form action="{{url_for('cursos.buscar_seccion', id=cursos[0].idCurso)}}" method="post" class="filtrar-alumno__form">
                <input type="search" placeholder="Buscar sección" class="filtrar-alumno__input" name="seccion">
            </form>
        </div>

        <hr class="divider">
    </div>

    <div class="table-responsive">
        <table class="table table-striped-columns table-alumnos" id="tablaAlumnos">
            <tr>
                <th>ID</th>
                <th>Profesor</th>
                <th>Sección</th>
            </tr>

            {% for record in secciones %}
                <tr>
                    <td>{{record.idSeccion}}</td>
                    <td>{{record.nombre}} {{record.apellido}}</td>
                    <td>{{record.seccion}}</td>
                    <td class="tabla-btn">
                        <button class="btn btn-primary btn-secciones" data-bs-toggle="modal" data-bs-target="#horario-modal" idseccion="{{record.idSeccion}}" onclick="buscar_horario_seccion(this.getAttribute('idseccion'))">
                            Horario
                        </button>
                        <input type="hidde" value="{{record.idSeccion}}" id="select-seccion-inscripcion">
                    </td>

                    <td class="tabla-btn">
                        <a href="{{url_for('cursos.calificaciones', idSeccion=record.idSeccion)}}" class="editar-link">
                            <button class="btn btn-primary btn-secciones">
                                Calificaciones
                            </button>
                        </a>
                    </td>


                    <td class="tabla-btn">
                        <a href="{{url_for('cursos.edit_seccion', id=record.idSeccion, idCurso=cursos[0].idCurso)}}" class="editar-link">
                            <button class="btn btn-primary">
                                Editar
                            </button>
                        </a>
                    </td>
                    <td class="tabla-btn">
                        <button class="btn btn-danger" idseccion="{{record.idSeccion}}" onclick="eliminar_seccion(this.getAttribute('idseccion'))">
                            Eliminar
                        </button>
                    </td>
                    
                </tr>

            {% endfor %}

        </table>
    </div>

    <div class="modal fade" id="horario-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog horario-modal-dialog">
                <div class="modal-content horario-modal">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Horario de la sección</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body horario-modal-body">
                        <div class="table-responsive horario__container crear-horario" id="horario__container">
                        <table class="table table-bordered border-dark table-horario" id="tabla-horario">
                        <tr>
                            <th>Hora</th>
                            <th>Lunes</th>
                            <th>Martes</th>
                            <th>Miércoles</th>
                            <th>Jueves</th>
                            <th>Viernes</th>
                            <th>Sábado</th>
                        </tr>

                        <tr>
                            <td class="hora-td">8:00-9:00 am</td>

                            <td data-dia="Lunes" data-hora-inicio="08:00:00" data-hora-fin="09:00:00" 
                            id="columna-lunes-8-9"></td>

                            <td data-dia="Martes" data-hora-inicio="08:00:00" data-hora-fin="09:00:00"
                            id="columna-martes-8-9"></td>

                            <td data-dia="Miercoles" data-hora-inicio="08:00:00" data-hora-fin="09:00:00"
                            id="columna-miercoles-8-9"></td>

                            <td data-dia="Jueves" data-hora-inicio="08:00:00" data-hora-fin="09:00:00"
                            id="columna-jueves-8-9"></td>

                            <td data-dia="Viernes" data-hora-inicio="08:00:00" data-hora-fin="09:00:00"
                            id="columna-viernes-8-9"></td>

                            <td data-dia="Sabado" data-hora-inicio="08:00:00" data-hora-fin="09:00:00"
                            id="columna-sabado-8-9"></td>

                        </tr>

                        <tr>
                            <td class="hora-td">9:00-10:00 am</td>

                            <td data-dia="Lunes" data-hora-inicio="09:00:00" data-hora-fin="10:00:00" 
                            id="columna-lunes-9-10"></td>

                            <td data-dia="Martes" data-hora-inicio="09:00:00" data-hora-fin="10:00:00"
                            id="columna-martes-9-10"></td>

                            <td data-dia="Miercoles" data-hora-inicio="09:00:00" data-hora-fin="10:00:00"
                            id="columna-miercoles-9-10"></td>

                            <td data-dia="Jueves" data-hora-inicio="09:00:00" data-hora-fin="10:00:00"
                            id="columna-jueves-9-10"></td>

                            <td data-dia="Viernes" data-hora-inicio="09:00:00" data-hora-fin="10:00:00"
                            id="columna-viernes-9-10"></td>

                            <td data-dia="Sabado" data-hora-inicio="09:00:00" data-hora-fin="10:00:00"
                            id="columna-sabado-9-10"></td>
                        </tr>

                        <tr>
                            <td class="hora-td">10:00-11:00 am</td>

                            <td data-dia="Lunes" data-hora-inicio="10:00:00" data-hora-fin="11:00:00" 
                            id="columna-lunes-10-11"></td>

                            <td data-dia="Martes" data-hora-inicio="10:00:00" data-hora-fin="11:00:00"
                            id="columna-martes-10-11"></td>

                            <td data-dia="Miercoles" data-hora-inicio="10:00:00" data-hora-fin="11:00:00"
                            id="columna-miercoles-10-11"></td>

                            <td data-dia="Jueves" data-hora-inicio="10:00:00" data-hora-fin="11:00:00"
                            id="columna-jueves-10-11"></td>

                            <td data-dia="Viernes" data-hora-inicio="10:00:00" data-hora-fin="11:00:00"
                            id="columna-viernes-10-11"></td>

                            <td data-dia="Sabado" data-hora-inicio="10:00:00" data-hora-fin="11:00:00"
                            id="columna-sabado-10-11"></td>
                        </tr>

                        <tr>
                            <td class="hora-td">11:00-12:00 am</td>

                            <td data-dia="Lunes" data-hora-inicio="11:00:00" data-hora-fin="12:00:00" 
                            id="columna-lunes-11-12"></td>

                            <td data-dia="Martes" data-hora-inicio="11:00:00" data-hora-fin="12:00:00"
                            id="columna-martes-11-12"></td>

                            <td data-dia="Miercoles" data-hora-inicio="11:00:00" data-hora-fin="12:00:00"
                            id="columna-miercoles-11-12"></td>

                            <td data-dia="Jueves" data-hora-inicio="11:00:00" data-hora-fin="12:00:00"
                            id="columna-jueves-11-12"></td>

                            <td data-dia="Viernes" data-hora-inicio="11:00:00" data-hora-fin="12:00:00"
                            id="columna-viernes-11-12"></td>

                            <td data-dia="Sabado" data-hora-inicio="11:00:00" data-hora-fin="12:00:00"
                            id="columna-sabado-11-12"></td>
                        </tr>

                        <tr>
                            <td class="hora-td">12:00-01:00 pm</td>

                            <td data-dia="Lunes" data-hora-inicio="12:00:00" data-hora-fin="13:00:00" 
                            id="columna-lunes-12-13"></td>

                            <td data-dia="Martes" data-hora-inicio="12:00:00" data-hora-fin="13:00:00"
                            id="columna-martes-12-13"></td>

                            <td data-dia="Miercoles" data-hora-inicio="12:00:00" data-hora-fin="13:00:00"
                            id="columna-miercoles-12-13"></td>

                            <td data-dia="Jueves" data-hora-inicio="12:00:00" data-hora-fin="13:00:00"
                            id="columna-jueves-12-13"></td>

                            <td data-dia="Viernes" data-hora-inicio="12:00:00" data-hora-fin="13:00:00"
                            id="columna-viernes-12-13"></td>

                            <td data-dia="Sabado" data-hora-inicio="12:00:00" data-hora-fin="13:00:00"
                            id="columna-sabado-12-13"></td>
                        </tr>

                        <tr>
                            <td class="hora-td">01:00-02:00 pm</td>

                            <td data-dia="Lunes" data-hora-inicio="13:00:00" data-hora-fin="14:00:00" 
                            id="columna-lunes-13-14"></td>

                            <td data-dia="Martes" data-hora-inicio="13:00:00" data-hora-fin="14:00:00"
                            id="columna-martes-13-14"></td>

                            <td data-dia="Miercoles" data-hora-inicio="13:00:00" data-hora-fin="14:00:00"
                            id="columna-miercoles-13-14"></td>

                            <td data-dia="Jueves" data-hora-inicio="13:00:00" data-hora-fin="14:00:00"
                            id="columna-jueves-13-14"></td>

                            <td data-dia="Viernes" data-hora-inicio="13:00:00" data-hora-fin="14:00:00"
                            id="columna-viernes-13-14"></td>

                            <td data-dia="Sabado" data-hora-inicio="13:00:00" data-hora-fin="14:00:00"
                            id="columna-sabado-13-14"></td>
                        </tr>

                        <tr>
                            <td class="hora-td">02:00-03:00 pm</td>

                            <td data-dia="Lunes" data-hora-inicio="14:00:00" data-hora-fin="15:00:00" 
                            id="columna-lunes-14-15"></td>

                            <td data-dia="Martes" data-hora-inicio="14:00:00" data-hora-fin="15:00:00"
                            id="columna-martes-14-15"></td>

                            <td data-dia="Miercoles" data-hora-inicio="14:00:00" data-hora-fin="15:00:00"
                            id="columna-miercoles-14-15"></td>

                            <td data-dia="Jueves" data-hora-inicio="14:00:00" data-hora-fin="15:00:00"
                            id="columna-jueves-14-15"></td>

                            <td data-dia="Viernes" data-hora-inicio="14:00:00" data-hora-fin="15:00:00"
                            id="columna-viernes-14-15"></td>

                            <td data-dia="Sabado" data-hora-inicio="14:00:00" data-hora-fin="15:00:00"
                            id="columna-sabado-14-15"></td>
                        </tr>

                        <tr>
                            <td class="hora-td">03:00-04:00 pm</td>

                            <td data-dia="Lunes" data-hora-inicio="15:00:00" data-hora-fin="16:00:00" 
                            id="columna-lunes-15-16"></td>

                            <td data-dia="Martes" data-hora-inicio="15:00:00" data-hora-fin="16:00:00"
                            id="columna-martes-15-16"></td>

                            <td data-dia="Miercoles" data-hora-inicio="15:00:00" data-hora-fin="16:00:00"
                            id="columna-miercoles-15-16"></td>

                            <td data-dia="Jueves" data-hora-inicio="15:00:00" data-hora-fin="16:00:00"
                            id="columna-jueves-15-16"></td>

                            <td data-dia="Viernes" data-hora-inicio="15:00:00" data-hora-fin="16:00:00"
                            id="columna-viernes-15-16"></td>

                            <td data-dia="Sabado" data-hora-inicio="15:00:00" data-hora-fin="16:00:00"
                            id="columna-sabado-15-16"></td>
                        </tr>

                        <tr>
                            <td class="hora-td">04:00-05:00 pm</td>

                            <td data-dia="Lunes" data-hora-inicio="16:00:00" data-hora-fin="17:00:00" 
                            id="columna-lunes-16-17"></td>

                            <td data-dia="Martes" data-hora-inicio="16:00:00" data-hora-fin="17:00:00"
                            id="columna-martes-16-17"></td>

                            <td data-dia="Miercoles" data-hora-inicio="16:00:00" data-hora-fin="17:00:00"
                            id="columna-miercoles-16-17"></td>

                            <td data-dia="Jueves" data-hora-inicio="16:00:00" data-hora-fin="17:00:00"
                            id="columna-jueves-16-17"></td>

                            <td data-dia="Viernes" data-hora-inicio="16:00:00" data-hora-fin="17:00:00"
                            id="columna-viernes-16-17"></td>

                            <td data-dia="Sabado" data-hora-inicio="16:00:00" data-hora-fin="17:00:00"
                            id="columna-sabado-16-17"></td>
                        </tr>
                    </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="filtrar-secciones-modal" tabindex="-1" aria-labelledby="filtrarSeccionesModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <!-- Header -->
                    <div class="modal-header bg-primary text-white">
                        <h1 class="modal-title fs-5" id="filtrarSeccionesModalLabel">Filtrar secciones</h1>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    
                    <!-- Body -->
                    <div class="modal-body">
                        <form id="filter-secciones__form" method="post" action="{{url_for('cursos.filtrar_seccion_cantidad', id=cursos[0].idCurso)}}">
                            <!-- Cantidad de participantes -->
                            <div class="mb-4">
                                <label for="cantidad-secciones" class="form-label fw-semibold">Cantidad de participantes</label>
                                <input type="number" 
                                    id="cantidad-secciones" 
                                    class="form-control form-control-lg" 
                                    name="cantidad"
                                    min="0"
                                    value="0"
                                    placeholder="Ingrese la cantidad">
                                <div class="form-text">Establezca el número de participantes para filtrar</div>
                            </div>
                            
                            <!-- Opciones de filtro -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold mb-3">Tipo de filtro</label>
                                
                                <div class="form-options">
                                    <!-- Mayor que -->
                                    <div class="form-check card-option mb-2">
                                        <input type="radio" 
                                            id="filtrar-mayor" 
                                            class="form-check-input" 
                                            name="filtro-participantes" 
                                            value="mayor" 
                                            checked>
                                        <label for="filtrar-mayor" class="form-check-label w-100 p-3 rounded border" id="filtrar-mayor-label">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-arrow-up text-success me-3"></i>
                                                <div>
                                                    <div class="fw-medium">Mayor que</div>
                                                    <small class="text-muted">Secciones con más participantes</small>
                                                </div>
                                            </div>
                                        </label>
                                    </div>

                                    <!-- Menor que -->
                                    <div class="form-check card-option mb-2">
                                        <input type="radio" 
                                            id="filtrar-menor" 
                                            class="form-check-input" 
                                            name="filtro-participantes" 
                                            value="menor">
                                        <label for="filtrar-menor" class="form-check-label w-100 p-3 rounded border" id="filtrar-menor-label">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-arrow-down text-warning me-3"></i>
                                                <div>
                                                    <div class="fw-medium">Menor que</div>
                                                    <small class="text-muted">Secciones con menos participantes</small>
                                                </div>
                                            </div>
                                        </label>
                                    </div>

                                    <!-- Igual a -->
                                    <div class="form-check card-option">
                                        <input type="radio" 
                                            id="filtrar-igual" 
                                            class="form-check-input" 
                                            name="filtro-participantes" 
                                            value="igual">
                                        <label for="filtrar-igual" class="form-check-label w-100 p-3 rounded border" id="filtrar-igual-label">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-equals text-info me-3"></i>
                                                <div>
                                                    <div class="fw-medium">Igual a</div>
                                                    <small class="text-muted">Secciones con exactamente esta cantidad</small>
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Botón de enviar -->
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-filter me-2"></i>
                                    Aplicar filtro
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    <script src="../../../../js/excel.js"></script>
    <script src="https://unpkg.com/xlsx@latest/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/file-saverjs@latest/FileSaver.min.js"></script>
    <script src="https://unpkg.com/tableexport@latest/dist/js/tableexport.min.js"></script>

{% endblock %}